<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Blend ‚Äì Character + Background by STIR PRODUCTION LTD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #000000 50%, #000000 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #e94560;
        }

        .section-number {
            background: #e94560;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }

        .upload-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 600px) {
            .upload-grid {
                grid-template-columns: 1fr;
            }
        }

        .upload-box {
            background: rgba(0, 0, 0, 0.3);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-box:hover {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }

        .upload-box.has-image {
            border-style: solid;
            border-color: #4ecca3;
        }

        .upload-box h3 {
            margin-bottom: 12px;
            color: #fff;
        }

        .upload-box input[type="file"] {
            display: none;
        }

        .upload-label {
            display: inline-block;
            padding: 10px 24px;
            background: #e94560;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-bottom: 12px;
        }

        .upload-label:hover {
            background: #ff6b6b;
        }

        .preview-container {
            margin-top: 12px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-container img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .preview-placeholder {
            color: #666;
            font-size: 0.9rem;
        }

        .prompt-textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .prompt-textarea:focus {
            outline: none;
            border-color: #e94560;
        }

        .prompt-hint {
            margin-top: 8px;
            color: #888;
            font-size: 0.85rem;
        }

        .generate-btn {
            width: 100%;
            padding: 16px 32px;
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            color: #fff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 16px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(233, 69, 96, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status-bar {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.95rem;
        }

        .status-bar.waiting {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }

        .status-bar.loading {
            background: rgba(78, 204, 163, 0.2);
            color: #4ecca3;
        }

        .status-bar.success {
            background: rgba(78, 204, 163, 0.2);
            color: #4ecca3;
        }

        .status-bar.error {
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #4ecca3;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Live Timer Styles */
        .live-timer {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding: 10px 20px;
            background: rgba(233, 69, 96, 0.15);
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #ff6b6b;
            font-family: 'Courier New', monospace;
        }

        .live-timer .timer-icon {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .output-container {
            text-align: center;
        }

        .output-placeholder {
            padding: 60px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            color: #666;
        }

        .output-image {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .output-actions {
            margin-top: 20px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .output-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .output-btn.download {
            background: #4ecca3;
            color: #1a1a2e;
            border: none;
        }

        .output-btn.download:hover {
            background: #3db892;
        }

        .output-btn.open {
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .output-btn.open:hover {
            border-color: #fff;
        }

        .hidden {
            display: none !important;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 0.9rem;
        }

        .render-time-badge {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background: rgba(78, 204, 163, 0.15);
            border: 1px solid rgba(78, 204, 163, 0.3);
            border-radius: 20px;
            color: #4ecca3;
            font-size: 0.9rem;
        }

        .render-time-badge .time-icon {
            margin-right: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Image Blend (DEMO FOR Airside)</h1>
            <p>Character + Background Composer by STIR</p>
        </header>

        <!-- Section 1: Upload Images -->
        <div class="section">
            <div class="section-title">
                <span class="section-number">1</span>
                <span>Upload Images</span>
            </div>
            <div class="upload-grid">
                <div class="upload-box" id="charUploadBox">
                    <h3>üë§ Character Image</h3>
                    <label class="upload-label" for="charInput">Choose File</label>
                    <input type="file" id="charInput" accept="image/*">
                    <div class="preview-container">
                        <span class="preview-placeholder" id="charPlaceholder">No file selected</span>
                        <img id="charPreview" class="hidden" alt="Character Preview">
                    </div>
                </div>
                <div class="upload-box" id="bgUploadBox">
                    <h3>üèûÔ∏è Background Image</h3>
                    <label class="upload-label" for="bgInput">Choose File</label>
                    <input type="file" id="bgInput" accept="image/*">
                    <div class="preview-container">
                        <span class="preview-placeholder" id="bgPlaceholder">No file selected</span>
                        <img id="bgPreview" class="hidden" alt="Background Preview">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Prompt -->
        <div class="section">
            <div class="section-title">
                <span class="section-number">2</span>
                <span>Prompt Instructions</span>
            </div>
            <textarea class="prompt-textarea" id="promptInput">Please cut out the character cleanly from the character image and blend them naturally into the background image.

Match lighting, shadows and color tones between character and background. 
Keep the character's facial features and hairstyle unchanged. 
Preserve high resolution and realistic details.</textarea>
            <p class="prompt-hint">You can edit this prompt to customize the output.</p>
            
            <button class="generate-btn" id="generateBtn">üöÄ Generate Image</button>
            
            <div class="status-bar waiting" id="statusBar">
                Waiting for input‚Ä¶
            </div>
            
            <!-- Live Timer -->
            <div class="live-timer hidden" id="liveTimer">
                <span class="timer-icon">‚è±Ô∏è</span>
                <span id="timerDisplay">00:00</span>
            </div>
        </div>

        <!-- Section 3: Output -->
        <div class="section">
            <div class="section-title">
                <span class="section-number">3</span>
                <span>Output</span>
            </div>
            <div class="output-container">
                <div class="output-placeholder" id="outputPlaceholder">
                    Generated image will appear here.
                </div>
                <img id="outputImage" class="output-image hidden" alt="Generated Image">
                
                <div class="render-time-badge hidden" id="renderTimeBadge">
                    <span class="time-icon">‚è±Ô∏è</span>
                    <span id="renderTimeText">Rendered in 0.0s</span>
                </div>
                
                <div class="output-actions hidden" id="outputActions">
                    <a class="output-btn download" id="downloadBtn" download="generated-image.png">
                        ‚¨áÔ∏è Download Image
                    </a>
                    <a class="output-btn open" id="openBtn" target="_blank">
                        üîó Open in New Tab
                    </a>
                </div>
            </div>
        </div>

        <footer>
            Powered by STIR PRODUCTION LTD
        </footer>
    </div>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        const BACKEND_URL = 'https://running-hub-api.onrender.com';
        
        // ========================================
        // DOM Elements
        // ========================================
        const charInput = document.getElementById('charInput');
        const bgInput = document.getElementById('bgInput');
        const charPreview = document.getElementById('charPreview');
        const bgPreview = document.getElementById('bgPreview');
        const charPlaceholder = document.getElementById('charPlaceholder');
        const bgPlaceholder = document.getElementById('bgPlaceholder');
        const charUploadBox = document.getElementById('charUploadBox');
        const bgUploadBox = document.getElementById('bgUploadBox');
        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const statusBar = document.getElementById('statusBar');
        const outputPlaceholder = document.getElementById('outputPlaceholder');
        const outputImage = document.getElementById('outputImage');
        const outputActions = document.getElementById('outputActions');
        const downloadBtn = document.getElementById('downloadBtn');
        const openBtn = document.getElementById('openBtn');
        const renderTimeBadge = document.getElementById('renderTimeBadge');
        const renderTimeText = document.getElementById('renderTimeText');
        
        // Live Timer Elements
        const liveTimer = document.getElementById('liveTimer');
        const timerDisplay = document.getElementById('timerDisplay');
        
        // Timer variables
        let timerInterval = null;
        let startTime = null;

        // ========================================
        // Image Preview Handlers
        // ========================================
        function handleImagePreview(input, preview, placeholder, uploadBox) {
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        preview.src = event.target.result;
                        preview.classList.remove('hidden');
                        placeholder.classList.add('hidden');
                        uploadBox.classList.add('has-image');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        handleImagePreview(charInput, charPreview, charPlaceholder, charUploadBox);
        handleImagePreview(bgInput, bgPreview, bgPlaceholder, bgUploadBox);

        // ========================================
        // Status Updates
        // ========================================
        function setStatus(message, type = 'waiting') {
            statusBar.className = `status-bar ${type}`;
            if (type === 'loading') {
                statusBar.innerHTML = `<span class="spinner"></span>${message}`;
            } else {
                statusBar.textContent = message;
            }
        }

        // ========================================
        // Live Timer Functions
        // ========================================
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function formatRenderTime(seconds) {
            if (seconds < 60) {
                return `${seconds.toFixed(1)}s`;
            } else {
                const mins = Math.floor(seconds / 60);
                const secs = (seconds % 60).toFixed(0);
                return `${mins}m ${secs}s`;
            }
        }

        function startTimer() {
            startTime = Date.now();
            liveTimer.classList.remove('hidden');
            timerDisplay.textContent = '00:00';
            
            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                timerDisplay.textContent = formatTime(elapsed);
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            liveTimer.classList.add('hidden');
        }

        // ========================================
        // Generate Image
        // ========================================
        generateBtn.addEventListener('click', async () => {
            const charFile = charInput.files[0];
            const bgFile = bgInput.files[0];
            const prompt = promptInput.value.trim();

            if (!charFile) {
                setStatus('‚ùå Please upload a character image.', 'error');
                return;
            }
            if (!bgFile) {
                setStatus('‚ùå Please upload a background image.', 'error');
                return;
            }
            if (!prompt) {
                setStatus('‚ùå Please enter a prompt.', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('prompt', prompt);
            formData.append('char_image', charFile);
            formData.append('bg_image', bgFile);

            // Update UI & Start Timer
            generateBtn.disabled = true;
            setStatus('Generating image...', 'loading');
            startTimer();
            
            outputPlaceholder.classList.remove('hidden');
            outputImage.classList.add('hidden');
            outputActions.classList.add('hidden');
            renderTimeBadge.classList.add('hidden');

            try {
                const response = await fetch(`${BACKEND_URL}/generate`, {
                    method: 'POST',
                    body: formData
                });

                const endTime = Date.now();
                const renderTimeSeconds = (endTime - startTime) / 1000;
                const formattedTime = formatRenderTime(renderTimeSeconds);

                stopTimer();

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `Server error: ${response.status}`);
                }

                const data = await response.json();

                if (data.imageUrl) {
                    outputImage.src = data.imageUrl;
                    outputImage.classList.remove('hidden');
                    outputPlaceholder.classList.add('hidden');
                    outputActions.classList.remove('hidden');
                    
                    renderTimeText.textContent = `Rendered in ${formattedTime}`;
                    renderTimeBadge.classList.remove('hidden');
                    
                    downloadBtn.href = data.imageUrl;
                    openBtn.href = data.imageUrl;
                    
                    setStatus(`‚úÖ Image generated successfully in ${formattedTime}!`, 'success');
                } else {
                    throw new Error('No image URL in response');
                }

            } catch (error) {
                stopTimer();
                const endTime = Date.now();
                const renderTimeSeconds = (endTime - startTime) / 1000;
                const formattedTime = formatRenderTime(renderTimeSeconds);
                
                console.error('Generation error:', error);
                setStatus(`‚ùå Failed after ${formattedTime}: ${error.message}`, 'error');
            } finally {
                generateBtn.disabled = false;
            }
        });

        // ========================================
        // Drag and Drop Support
        // ========================================
        function setupDragDrop(uploadBox, input) {
            uploadBox.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadBox.style.borderColor = '#e94560';
                uploadBox.style.background = 'rgba(233, 69, 96, 0.2)';
            });

            uploadBox.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadBox.style.borderColor = '';
                uploadBox.style.background = '';
            });

            uploadBox.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadBox.style.borderColor = '';
                uploadBox.style.background = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('image/')) {
                    input.files = files;
                    input.dispatchEvent(new Event('change'));
                }
            });
        }

        setupDragDrop(charUploadBox, charInput);
        setupDragDrop(bgUploadBox, bgInput);
    </script>
</body>
</html>